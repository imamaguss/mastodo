<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Todo - Dasboard</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="list.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl"crossorigin="anonymous"></script>
  <style>
    #box-card {
      margin: 0 20px 10px 10px;
    }
  </style>
</head>

<body>
  <section style="margin-bottom:15px">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">masTODO</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a id="sayhii" class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">Create</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              Dropdown link
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </li>
        </ul>
      </div>
      <a class="nav-link" href="#" id="logout" onclick="logout()">Logout</a>
    </nav>
  </section>

    <div class="container">
      <div class="row">
        <div class="col-md-2">
          <label name="filter" id=""> Filter By: <br>
            <input type="radio" value="">
            <label for="">Due Date</label> <br>
            <input type="radio" value="">
            <label for="">Tag</label>
          </label> 
        </div>
        <div class="col-md-8">
          <div class="row" id="list">
            <div class="list"></div>
          </div>  
        </div>
        <div class="col-md-2">right-bar</div>
      </div>
    </div>

  <section class="container">
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" id="tes">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">New Activity</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Name:</label>
                <input type="text" class="form-control" id="name">
              </div>
              <div class="form-group">
                <label for="message-text" class="col-form-label">Description:</label>
                <input type="text" class="form-control" id="description">
              </div>
              <div class="form-group">
                <label for="message-text" class="col-form-label">Due Date:</label>
                <input type="date" class="form-control" id="dueDate">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="save">Save</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    const name = localStorage.getItem('name');
    const token = localStorage.getItem('token');
    if(!token) {
      window.location.href = 'index.html';
    } else {
      
      $("#sayhii").text(`Hii ${name}`);
      console.log(token);
      
      $.ajax({
        method: "GET",
        url: 'http://localhost:3012/todo', 
        headers: {
          token
        }
      })
      .done(result => {
        const name = localStorage.getItem('name');
        result.todos.forEach(todo => {
          let date = new Date(todo.dueDate);
          $("#list").append(`
            <div class="col-md-4" id="box-card">
              <div class="card" style="width: 17rem">
                <div class="card-body">
                  <h5 class="card-title" style="font-weight: bold">${todo.name}</h5>
                  <hr>
                  <p class="card-text">Description: ${todo.description}</p>
                  <p class="card-text">Due Date: ${date.getDate()}/${date.getMonth()}/${date.getFullYear()}</p>
                  <a href="#" class="btn btn-warning" onClick="update('${todo._id}', '${todo.name}', '${todo.description}', '${todo.dueDate}')" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">UPDATE</a>
                  <a href="#" class="btn btn-danger" onClick="removeTodo('${todo._id}')">DELETE</a>
                </div>
              </div>
              
            </div>
          `)
        })
      })
  
      $("#save").click(() => {
        const name = $("#name").val();
        const description = $("#description").val();
        const dueDate = $("#dueDate").val();
        $.ajax({
          method: 'post',
          url: 'http://localhost:3012/todo',
          data: { name, description, dueDate, userId: localStorage.getItem('userId') },
          headers: { token }
        })
        .done(result => {
          location.reload();
        })
      })
    
      function update(id, name, description, dueDate) {
        $("#tes")
        .text('')
        .append(`
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Update Activity</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Name:</label>
                <input type="text" class="form-control" id="name" value="${name}">
              </div>
              <div class="form-group">
                <label for="message-text" class="col-form-label">Description:</label>
                <input type="text" class="form-control" id="description" value="${description}">
              </div>
              <div class="form-group">
                <label for="message-text" class="col-form-label">Due Date:</label>
                <input type="date" class="form-control" id="dueDate" value="${dueDate}">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onClick="submitUpdate('${id}')" id="btn-update">Update</button>
          </div>
        `)
      }
      
      function submitUpdate(id) {
        const name = $("#name").val();
        const description = $("#description").val();
        const dueDate = $("#dueDate").val();
        
        $.ajax({
          method: 'put',
          url: `http://localhost:3012/todo/${id}`,
          data: { name, description, dueDate }
        })
        .done(result => {
          location.reload();
        })
      }
  
      function removeTodo(id) {
        $.ajax({
          method: 'delete',
          url: `http://localhost:3012/todo/${id}`
        })
        .done(result => {
          location.reload();
        })
      }
  
      $("#logout").click(() => {
        localStorage.removeItem('token')
      })
      
      function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('name');
        localStorage.removeItem('userId');
        window.location.href = 'index.html'
      }
    }

  </script>

</body>

</html>